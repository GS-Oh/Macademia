<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="signMapper">
	<select id="getListAll"
		resultType="com.kh.md.member.vo.MemberVo">

		SELECT
		P.NAME AS POSITION_NAME
		,P.RANK_NO
		,D.NAME AS DEPT_NAME
		,D.UPPER_DEPT
		,D.LEV
		,M.NO AS NO
		,M.NAME AS NAME
		FROM POSITION P
		JOIN DEPT D ON P.DEPT_NO = D.NO
		JOIN MEMBER M ON M.POSITION_NO = P.NO
	</select>
	<select id="getListDept"
		resultType="com.kh.md.member.vo.MemberVo">
		SELECT
		P.NAME AS POSITION_NAME
		,P.RANK_NO
		,D.NAME AS DEPT_NAME
		,D.UPPER_DEPT
		,D.LEV
		,M.NO AS NO
		,M.NAME AS NAME
		FROM POSITION P
		JOIN DEPT D ON P.DEPT_NO = D.NO
		JOIN MEMBER M ON M.POSITION_NO = P.NO
		WHERE D.NO = #{deptNo}
	</select>

	<insert id="signWrite" parameterType="com.kh.md.sign.vo.SignVo">

		INSERT INTO SIGN
		(S_NO
		, E_NO
		, S_TYPE_NO
		,S_TITLE
		,S_CONTENT)

		VALUES(SEQ_SIGN_NO.NEXTVAL
		,#{eNo}
		,#{sTypeNo}
		,#{sTitle}
		,#{sContent}
		)
		<selectKey keyProperty="sNo" resultType="java.lang.String" order="AFTER"> 
			SELECT SEQ_SIGN_NO.CURRVAL FROM DUAL
		</selectKey>

	</insert>
	<insert id="insertSignLine">
		INSERT INTO SIGN_LINE
		(SL_NO 
		,E_NO 
		,S_NO 
		,S_LEVEL) 
		SELECT SEQ_SIGN_LINE_NO.NEXTVAL, A.* FROM(
			<foreach collection="list" item="item" separator="UNION ALL">
				SELECT #{item.eNo} AS E_NO,
					   #{item.sNo} AS S_NO,
					   #{item.sLevel} AS S_LEVEL
				FROM DUAL
			</foreach>) A
	</insert>


</mapper>