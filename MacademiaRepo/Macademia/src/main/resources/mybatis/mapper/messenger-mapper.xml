<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace = "messengerMapper">
	
	
	
	
	<!-- 게시글 메인화면 -->
	<select id="selectNoticeAll" resultType="com.kh.md.messenger.vo.MsgNoticeVo">
	
		SELECT 
		     N.NOTICE_NO
		    ,B.NAME MSG_NO
		    ,N.TITLE
		    ,N.CONTENT
		    ,N.COUNT
		    ,N.ENROLL_DATE
		FROM MSG_NOTICE N 
		JOIN MESSENGER M
		ON N.MSG_NO = M.MSG_NO
		JOIN MEMBER B
		ON M.NO = B.NO
		WHERE N.CHECK_DELETE = 'O'
		ORDER BY N.NOTICE_NO DESC
	
	</select>
	
	
	
	<!-- 게시글 상세화면 -->
	<select id="selectOneByNo" resultType="com.kh.md.messenger.vo.MsgNoticeVo">
		
		SELECT 
		     N.NOTICE_NO
		    ,B.NAME MSG_NO
		    ,N.TITLE
		    ,N.CONTENT
		    ,N.COUNT
		    ,N.ENROLL_DATE
		FROM MSG_NOTICE N 
		JOIN MESSENGER M
		ON N.MSG_NO = M.MSG_NO
		JOIN MEMBER B
		ON M.NO = B.NO
		WHERE N.NOTICE_NO = #{no} 
		AND N.CHECK_DELETE = 'O'
		ORDER BY N.NOTICE_NO DESC	
	
	</select>
	
	<!-- 공지톡 게시글 조회 수 증가 -->
	<update id="increaseHit">
		UPDATE MSG_NOTICE
			SET COUNT = COUNT + 1
		WHERE NOTICE_NO = #{no}
		AND CHECK_DELETE = 'O'
	</update>
	
	
	<!-- 공지톡 게시글 입력 -->
	<insert id="insertNotice">
	
		INSERT INTO MSG_NOTICE(
		     NOTICE_NO      
		    ,MSG_NO 
		    ,TITLE 
		    ,CONTENT 
		) VALUES(
		    SEQ_MSG_NOTICE_NO.NEXTVAL
		    ,#{msgNo}
		    ,#{title}
		    ,#{content}
		)
	
	</insert>


	<!-- 공지톡 수정 화면 -->
	<select id="selectEditByNo" resultType="com.kh.md.messenger.vo.MsgNoticeVo">
		SELECT 
		     N.NOTICE_NO
		    ,B.NAME MSG_NO
		    ,N.TITLE
		    ,N.CONTENT
		    ,N.COUNT
		    ,N.ENROLL_DATE
		FROM MSG_NOTICE N 
		JOIN MESSENGER M
		ON N.MSG_NO = M.MSG_NO
		JOIN MEMBER B
		ON M.NO = B.NO
		WHERE N.NOTICE_NO = #{no} 
		AND N.CHECK_DELETE = 'O'
	</select>

	<!-- 공지톡 수정 처리 -->
	<update id="updateEdit">
		UPDATE MSG_NOTICE
			SET  TITLE = #{title}
				,CONTENT = #{content}
		WHERE NOTICE_NO = #{noticeNo}
		AND CHECK_DELETE = 'O'
	</update>


	<!-- 공지톡 삭제 처리 -->
	<update id="updateDelete">
		UPDATE MSG_NOTICE
			SET CHECK_DELETE = 'X'
		WHERE NOTICE_NO = #{no}
	</update>


	<!-- 공지톡 게시글 총 수 -->
	<select id="selectTotalCnt" resultType="_int">
		SELECT COUNT(NOTICE_NO)
		FROM MSG_NOTICE
		WHERE CHECK_DELETE = 'O'
	</select>



	<!-- 공지톡 댓글 입력 -->
	<insert id="insertReple">
		INSERT INTO MSG_NOTICE_REPLE(
		     REPLE_NO
		    ,MSG_NO
		    ,NOTICE_NO
		    ,CONTENT
		)VALUES(
		     SEQ_MSG_NOTICE_REPLE_NO.NEXTVAL
		    ,#{msgNo}
		    ,#{noticeNo}
		    ,#{content}
		)
	
	</insert>	
	
	<!-- 공지톡 댓글 리스트 가져오기 -->
	<select id="selectRepleList" resultType="com.kh.md.messenger.vo.MsgRepleVo">
		
		SELECT 
		     N.REPLE_NO
		    ,B.NAME MSG_NO
		    ,N.NOTICE_NO
		    ,N.CONTENT
		    ,N.ENROLL_DATE
		FROM MSG_NOTICE_REPLE N
		JOIN MESSENGER M ON N.MSG_NO = M.MSG_NO
		JOIN MEMBER B ON M.NO = B.NO
		WHERE N.NOTICE_NO = #{no}
		AND N.CHECK_DELETE = 'O'
		ORDER BY N.REPLE_NO DESC
	</select>
	
	
	<!-- 공지톡 댓글 삭제 -->
	<update id="updateRepleDelete">
		UPDATE MSG_NOTICE_REPLE
			SET CHECK_DELETE = 'X'
		WHERE REPLE_NO = #{repleNo}
	</update>
	
	
	
	
	
	

</mapper>
