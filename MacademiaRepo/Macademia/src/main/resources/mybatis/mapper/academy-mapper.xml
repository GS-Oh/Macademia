<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace = "academyMapper">
	
	<select id="selectCategory" resultType="CategoryVo">
		SELECT NO, NAME
		FROM CLASS_CATEGORY
	</select>
	
	<select id="selectInstructor" resultType="MemberVo">
		SELECT NO, NAME
		FROM MEMBER
		WHERE POSITION_NO = 44
		OR POSITION_NO = 47
		OR POSITION_NO = 48
	</select>
	
	<insert id="insertClass">
		INSERT INTO CLASS(NO,CATEGORY_NO,NAME,DESCRIPTION,MAX,MEMBER_NO,FEE,CLASSROOM,BEGIN_DATE,END_DATE,START_TIME,FINISH_TIME) 
    	VALUES(SEQ_CLASS_NO.NEXTVAL, #{categoryNo}, #{name}, #{description}, #{max}, #{memberNo}, #{fee}, #{classroom}, #{beginDate}, #{endDate}, #{startTime}, #{finishTime})
	</insert>
	
	<insert id="insertCurriculum">
		BEGIN
			<foreach collection="cvo" item="curriculumName">
		    INSERT INTO CURRICULUM(NO, CLASS_NO, CURRICULUM_NAME, CURRICULUM_CONTENT) 
		    VALUES (SEQ_CURRICULUM_NO.NEXTVAL, SEQ_CLASS_NO.CURRVAL, #{curriculumName}, #{curriculumContent});
		    </foreach>
		END;
	</insert>
	
	<insert id="insertStudent">
		INSERT INTO STUDENT(NO,NAME,GENDER,PHONE,EMAIL,PROFILE,NEW_ADDRESS,OLD_ADDRESS,DETAIL_ADDRESS,BIRTH,FINAL_DEGREE,MAJOR,ENROLLED_CLASS,STD_COMMENT) 
    	VALUES(SEQ_STUDENT_NO.NEXTVAL,#{name},#{gender},#{phone},#{email},#{profile},#{newAddress},#{oldAddress},#{detailAddress},#{birth},#{finalDegree},#{major},#{enrolledClass},#{stdComment})
	</insert>
	
	<select id="selectStdList" resultType="StudentVo">
		SELECT S.NO, S.NAME, S.GENDER, S.PHONE, S.EMAIL, S.PROFILE, S.NEW_ADDRESS, S.OLD_ADDRESS, S.DETAIL_ADDRESS, S.BIRTH, S.FINAL_DEGREE, S.MAJOR, C.NAME AS ENROLLED_CLASS, S.JOIN_DATE, S.STD_COMMENT, S.COMPLETE_DATE
		FROM STUDENT S
		JOIN CLASS C ON S.ENROLLED_CLASS = C.NO
		WHERE S.COMPLETE_DATE IS NULL
		ORDER BY S.NAME
	</select>
	
	<select id="selectClassList" resultType="ClassVo">
		SELECT C.NO,T.NAME AS CATEGORY_NO, C.NAME, M.NAME AS MEMBER_NO, C.CLASSROOM, C.MAX, TO_CHAR(C.BEGIN_DATE, 'YY-MM-DD') AS BEGIN_DATE,TO_CHAR(C.END_DATE, 'YY-MM-DD') AS END_DATE, C.START_TIME,C.FINISH_TIME,C.STATUS
		FROM CLASS C
		JOIN MEMBER M ON C.MEMBER_NO = M.NO
		JOIN CLASS_CATEGORY T ON C.CATEGORY_NO = T.NO
		ORDER BY C.BEGIN_DATE
	</select>
	
	<select id="selectOneStudent" resultType="StudentVo">
		SELECT S.NO, S.NAME, S.GENDER, S.PHONE, S.EMAIL, S.PROFILE, S.NEW_ADDRESS, S.OLD_ADDRESS, S.DETAIL_ADDRESS, TO_CHAR(S.BIRTH, 'YYYY-MM-DD') AS BIRTH, S.FINAL_DEGREE, S.MAJOR, C.NAME AS ENROLLED_CLASS, S.JOIN_DATE, S.STD_COMMENT, S.COMPLETE_DATE
		FROM STUDENT S
		JOIN CLASS C ON S.ENROLLED_CLASS = C.NO
		WHERE S.NO = #{no}
	</select>
	
	
	<select id="selectTotalCount" resultType="int">
		SELECT COUNT(NO) FROM STUDENT
	</select>
	
	<select id="selectTotalClassCount" resultType="int">
		SELECT COUNT(NO) FROM CLASS
	</select>
</mapper>
